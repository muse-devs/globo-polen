jQuery(function(e){"use strict";try{var n=Stripe(zcwc_stripe_connect_params.key)}catch(e){return void console.log(e)}"yes"==zcwc_stripe_connect_params.is_change_payment_page&&e(document.body).trigger("updated_checkout");var t,r,o,c=Object.keys(zcwc_stripe_connect_params.elements_options).length?zcwc_stripe_connect_params.elements_options:{},i=n.elements(c),s={unmountElements:function(){t.unmount("#zcwc_stripe_connect-card-number"),r.unmount("#zcwc_stripe_connect-card-expiry"),o.unmount("#zcwc_stripe_connect-card-cvc")},mountElements:function(){e("#zcwc_stripe_connect-card-number").length&&(t.mount("#zcwc_stripe_connect-card-number"),r.mount("#zcwc_stripe_connect-card-expiry"),o.mount("#zcwc_stripe_connect-card-cvc"))},createElements:function(){var n={base:{iconColor:"#666EE8",color:"#31325F",fontSize:"15px","::placeholder":{color:"#CFD7E0"}}},c={base:"input-text",focus:"focused",empty:"empty",invalid:"invalid"};n=zcwc_stripe_connect_params.elements_styling?zcwc_stripe_connect_params.elements_styling:n,c=zcwc_stripe_connect_params.elements_classes?zcwc_stripe_connect_params.elements_classes:c,t=i.create("cardNumber",{style:n,classes:c}),r=i.create("cardExpiry",{style:n,classes:c}),o=i.create("cardCvc",{style:n,classes:c}),t.addEventListener("change",function(n){s.onCCFormChange(),n.error&&e(document.body).trigger("stripeConnectError",n)}),r.addEventListener("change",function(n){s.onCCFormChange(),n.error&&e(document.body).trigger("stripeConnectError",n)}),o.addEventListener("change",function(n){s.onCCFormChange(),n.error&&e(document.body).trigger("stripeConnectError",n)}),"yes"===zcwc_stripe_connect_params.is_checkout?e(document.body).on("updated_checkout",function(){t&&s.unmountElements(),s.mountElements()}):(e("form#add_payment_method").length||e("form#order_review").length)&&s.mountElements()},init:function(){"yes"===zcwc_stripe_connect_params.is_change_payment_page||zcwc_stripe_connect_params.is_pay_for_order_page,e("form.woocommerce-checkout").length&&(this.form=e("form.woocommerce-checkout")),e("form.woocommerce-checkout").on("checkout_place_order_zcwc_stripe_connect",this.onSubmit),e("form#order_review").length&&(this.form=e("form#order_review")),e("form#order_review, form#add_payment_method").on("submit",this.onSubmit),e("form#add_payment_method").length&&(this.form=e("form#add_payment_method")),e("form.woocommerce-checkout").on("change",this.reset),e(document.body).on("stripeConnectError",this.onError).on("checkout_error",this.reset),s.createElements(),window.addEventListener("hashchange",s.onHashChange),s.maybeConfirmIntent()},isStripeChosen:function(){return e("#payment_method_zcwc_stripe_connect").is(":checked")||e("#payment_method_zcwc_stripe_connect").is(":checked")&&"new"===e('input[name="wc-zcwc_stripe_connect-payment-token"]:checked').val()},isStripeSaveCardChosen:function(){return e("#payment_method_zcwc_stripe_connect").is(":checked")&&e('input[name="wc-zcwc_stripe_connect-payment-token"]').is(":checked")&&"new"!==e('input[name="wc-zcwc_stripe_connect-payment-token"]:checked').val()},isStripeCardChosen:function(){return e("#payment_method_zcwc_stripe_connect").is(":checked")},hasSource:function(){return 0<e("input.stripe-connect-source").length},hasCVCToken:function(){return 0<e("input.stripe-connect-cvc-token").length},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},block:function(){s.isMobile()||s.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){s.form&&s.form.unblock()},getSelectedPaymentElement:function(){return e('.payment_methods input[name="payment_method"]:checked')},createSource:function(){return n.createToken(t,{}).then(s.sourceResponse)},createCVCToken:function(){return n.createToken("cvc_update",o).then(s.cvcResponse)},sourceResponse:function(n){if(n.error)return e(document.body).trigger("stripeConnectError",n);s.reset(),s.form.append(e('<input type="hidden" />').addClass("stripe-connect-source").attr("name","zcwc_stripe_connect_credit_card_hash").val(n.token.id)),e("form#add_payment_method").length&&e(s.form).off("submit",s.form.onSubmit),s.form.submit()},cvcResponse:function(n){if(n.error)return e(document.body).trigger("stripeConnectError",n);s.reset(),s.form.append(e('<input type="hidden" />').addClass("stripe-connect-cvc-token").attr("name","zcwc_stripe_connect_cvc_token").val(n.token.id)),console.log("token_id",n.token.id),e("form#add_payment_method").length&&e(s.form).off("submit",s.form.onSubmit),s.form.submit()},onSubmit:function(){return!s.isStripeChosen()||(!!s.hasSource()||(s.isStripeSaveCardChosen()?"yes"!=zcwc_stripe_connect_params.cvc_on_saved||("yes"==zcwc_stripe_connect_params.is_change_payment_page||(!!s.hasCVCToken()||(s.block(),s.createCVCToken(),!1))):(s.block(),s.createSource(),!1)))},onCCFormChange:function(){s.reset()},reset:function(){console.log("reset"),e(".wc-stripe-connect-error, .stripe-connect-source, .stripe-connect-cvc-token").remove()},onError:function(n,t){var r,o=t.error.message,c=s.getSelectedPaymentElement().closest("li");console.log("error message",o),r=c.find(".stripe-connect-source-errors"),console.log("container",r),"email_invalid"===t.error.code?o=zcwc_stripe_connect_params.email_invalid:"invalid_request_error"!==t.error.type&&"api_connection_error"!==t.error.type&&"api_error"!==t.error.type&&"authentication_error"!==t.error.type&&"rate_limit_error"!==t.error.type||(o=zcwc_stripe_connect_params.invalid_request_error),"card_error"===t.error.type&&zcwc_stripe_connect_params.hasOwnProperty(t.error.code)&&(o=zcwc_stripe_connect_params[t.error.code]),"validation_error"===t.error.type&&zcwc_stripe_connect_params.hasOwnProperty(t.error.code)&&(o=zcwc_stripe_connect_params[t.error.code]),s.reset(),e(".woocommerce-NoticeGroup-checkout").remove(),console.log(t.error.message),e(r).html('<ul class="woocommerce_error woocommerce-error wc-stripe-connect-error"><li /></ul>'),e(r).find("li").text(o),e(".wc-stripe-connect-error").length&&e("html, body").animate({scrollTop:e(".wc-stripe-connect-error").offset().top-250},200),s.unblock(),e.unblockUI()},onHashChange:function(){var e=window.location.hash.match(/^#?confirm-connect-(pi|si)-([^:]+):(.+)$/);if(e&&!(4>e.length)){var n=e[1],t=e[2],r=decodeURIComponent(e[3]);window.location.hash="",s.openIntentModal(t,r,!1,"si"===n)}},maybeConfirmIntent:function(){if(e("#stripe-connect-intent-id").length&&e("#stripe-connect-intent-return").length){var n=e("#stripe-connect-intent-id").val(),t=e("#stripe-connect-intent-return").val();s.openIntentModal(n,t,!0,!1)}},openIntentModal:function(t,r,o,c){n[c?"handleCardSetup":"handleCardPayment"](t).then(function(e){if(e.error)throw e.error;var n=e[c?"setupIntent":"paymentIntent"];"requires_capture"===n.status||"succeeded"===n.status?window.location=r:s.unblock()}).catch(function(n){if(o)return window.location=r;e(document.body).trigger("stripeConnectError",{error:n}),e(".stripe-connect-source").remove(),s.unblock(),s.form.removeClass("processing"),e.get(r+"&is_ajax")})}};s.init()});